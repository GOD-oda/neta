<!DOCTYPE html>
<html lang="ja" prefix="og: http://ogp.me/ns#">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
  <meta name="description" content="前提 ローカルでDynamoDBに関するコマンドを実行する docker-compose.ymlを使う 作ったテーブルや項目は残しておきたい aws" />
  <meta property="og:title" content="DynamoDBをローカル環境に作る" />
  <meta property="og:type" content="article" />
  <meta property="og:image" content="https://blog.oda.world/og_image.png" />
  <meta property="og:site_name" content="ODA WORLD" />
  <meta property="og:description" content="前提 ローカルでDynamoDBに関するコマンドを実行する docker-compose.ymlを使う 作ったテーブルや項目は残しておきたい aws" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@oskfjzp" />
  <meta name="twitter:player" content="@oskfjzp" />
  <title>DynamoDBをローカル環境に作る</title>
  <link href="https://blog.oda.world/css/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  
  
  <link href="https://blog.oda.world/css/syntax.css"> 
  
  <link rel="apple-touch-icon" sizes="57x57" href="https://blog.oda.world/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://blog.oda.world/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://blog.oda.world/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://blog.oda.world/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://blog.oda.world/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://blog.oda.world/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://blog.oda.world/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://blog.oda.world/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://blog.oda.world/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="https://blog.oda.world/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://blog.oda.world/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="https://blog.oda.world/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://blog.oda.world/favicon-16x16.png">
  <link rel="manifest" href="https://blog.oda.world/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="https://blog.oda.world/sass/main.min.16de26b8759977d1cfde43c45a53dca1bc25280f1ee52a752366d1bd4f5b64f4.css">
  <style type="text/css">
  
    footer.page-footer{background-image: url(https://blog.oda.world/images/default.png);}
  
  </style>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-93E1496REW"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-93E1496REW');
  </script>
  <link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
</head>
<body>
  <div class="header-section">
    <ul id="slide-out" class="side-nav">
      <li><a href="https://blog.oda.world"><i class="mdi-action-home left"></i>Home<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
      <li><a href="https://blog.oda.world/categories"><i class="mdi-action-perm-media left"></i>Categories<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
      <li><a href="https://blog.oda.world/tags"><i class="mdi-action-loyalty left"></i>Tags<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
    </ul>
    <a data-activates="slide-out" class="btn-floating button-collapse nav-menu" style="top: 5px; left: 5px;"><i class="mdi-navigation-menu"></i></a>
    <div class="section no-pad-bot">
      <div class="container">
        
        <h1 class="header center teal-text text-lighten-2">DynamoDBをローカル環境に作る</h1>
        <div class="row center">
          <h5 class="header col s12 light"></h5>
        </div>
        <div class="row center">
         
         
           <a href="https://github.com/GOD-oda"><img src="https://blog.oda.world/images/github2-dreamstale35.png"></a>
         
         
           <a href="https://www.facebook.com/last.pass.oda"><img src="https://blog.oda.world/images/facebook-dreamstale25.png"></a>
         
         
           <a href="https://twitter.com/@oskfjzp"><img src="https://blog.oda.world/images/twitter-dreamstale71.png"></a>
         
         
         
         <a href="https://blog.oda.world/index.xml"><img src="https://blog.oda.world/images/feed-dreamstale27.png"></a>
        </div>
      </div>
    </div>
  </div>



<div class="article">
  <div class="container">
    <div class="section">
  
      <div class="row">
        <div class="col s12">
          <div class="">
            
            <p>
             
            </p>
            <p><h1 id="前提">前提</h1>
<ul>
<li>ローカルでDynamoDBに関するコマンドを実行する</li>
<li>docker-compose.ymlを使う</li>
<li>作ったテーブルや項目は残しておきたい</li>
<li>awsコマンドは打てる状態でshellスクリプトで実行する</li>
</ul>
<h1 id="やることとゴール">やることとゴール</h1>
<ul>
<li>dynamodbのコンテナをdocker-compose.ymlで</li>
<li>テーブル作成</li>
<li>テーブル確認</li>
<li>項目挿入</li>
<li>scan実行</li>
<li>データのマウント</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">% tree
.
├── bin
│   ├── config.sh
│   ├── create-table.sh
│   ├── insert-item.sh
│   ├── list-tables.sh
│   └── scan.sh
└── docker-compose.yml
</code></pre></div><h1 id="環境用意">環境用意</h1>
<h2 id="docker-composeyml">docker-compose.yml</h2>
<p>まずは<code>docker-compose.yml</code>で<code>DynamoDB Local</code>イメージのコンテナの準備をする</p>
<p>動作する必要最低限の<code>docker-compose.yml</code>はこうなる</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3.8&#39;</span>
<span style="color:#f92672">services</span>:
  <span style="color:#f92672">dynamodb</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">amazon/dynamodb-local</span>
</code></pre></div><p>この状態で<code>docker-compose up</code>を実行するとイメージを取得してコンテナが立ち上がる</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">% docker-compose up
Creating network <span style="color:#e6db74">&#34;72_default&#34;</span> with the default driver
Pulling dynamodb <span style="color:#f92672">(</span>amazon/dynamodb-local:<span style="color:#f92672">)</span>...
latest: Pulling from amazon/dynamodb-local
2cbe74538cb5: Pull complete
137077f50205: Pull complete
58932e640a40: Pull complete
Digest: sha256:bdd26570dc0e0ae49e1ea9d49ff662a6a1afe9121dd25793dc40d02802e7e806
Status: Downloaded newer image <span style="color:#66d9ef">for</span> amazon/dynamodb-local:latest
Creating 72_dynamodb_1 ... <span style="color:#66d9ef">done</span>
Attaching to 72_dynamodb_1
dynamodb_1  | Initializing DynamoDB Local with the following configuration:
dynamodb_1  | Port:	<span style="color:#ae81ff">8000</span>
dynamodb_1  | InMemory:	true
dynamodb_1  | DbPath:	null
dynamodb_1  | SharedDb:	false
dynamodb_1  | shouldDelayTransientStatuses:	false
dynamodb_1  | CorsParams:	*
dynamodb_1  |

</code></pre></div><p>さて、ログを見ると<code>InMemory: true</code>となっており、このままだとコンテナを落とすとせっかく投入したデータが消えてしまいます</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">dynamodb_1  | Initializing DynamoDB Local with the following configuration:
dynamodb_1  | Port:	<span style="color:#ae81ff">8000</span>
dynamodb_1  | InMemory:	true    &lt;---------------------ここ
.
.
.
</code></pre></div><p>消えないようにボリュームマウントしたいわけですがこの<code>InMemory</code>オプションが邪魔になります</p>
<p>ということで<code>docker-compose.yml</code>に追記します</p>
<ul>
<li>commandを上書きしましょ</li>
<li>portの設定をしないとホスト側からコンテナ側へ繋げられないね？</li>
<li>volumesでマウントするんだ</li>
</ul>
<p>完成したのがこちら</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">  version: &#39;3.8&#39;
  services:
    dynamodb:
      image: amazon/dynamodb-local
<span style="color:#a6e22e">+     command: &#34;-jar DynamoDBLocal.jar -dbPath .&#34;
</span><span style="color:#a6e22e">+     ports:
</span><span style="color:#a6e22e">+       - &#34;8000:8000&#34;
</span><span style="color:#a6e22e">+     volumes:
</span><span style="color:#a6e22e">+       - &#34;dynamodb:/home/dynamodblocal&#34;
</span><span style="color:#a6e22e">+ volumes:
</span><span style="color:#a6e22e">+   dynamodb:
</span><span style="color:#a6e22e">+     driver: local
</span></code></pre></div><p>ちなみにデフォルトのコマンドはこのようになってますね</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">% docker ps --no-trunc -f ancestor<span style="color:#f92672">=</span>amazon/dynamodb-local
CONTAINER ID                                                       IMAGE                   COMMAND                                   CREATED          STATUS          PORTS      NAMES
6a527476c032121902fcedfef532ceed06e548c6a38c46966bcc69fb9855e58b   amazon/dynamodb-local   <span style="color:#e6db74">&#34;java -jar DynamoDBLocal.jar -inMemory&#34;</span>   <span style="color:#ae81ff">16</span> minutes ago   Up <span style="color:#ae81ff">16</span> minutes   8000/tcp   72_dynamodb_1
</code></pre></div><p>コンテナを起動して、COMMANDとPORTS状態を確認してみましょう</p>
<p>問題なさそうですね</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">% docker ps --no-trunc -f ancestor<span style="color:#f92672">=</span>amazon/dynamodb-local
CONTAINER ID                                                       IMAGE                   COMMAND                                   CREATED          STATUS          PORTS                                       NAMES
fd850211e368d4522968e6f9f43c7e2764ac3b1e28cc14083f88bbe1bf9914ad   amazon/dynamodb-local   <span style="color:#e6db74">&#34;java -jar DynamoDBLocal.jar -dbPath .&#34;</span>   <span style="color:#ae81ff">45</span> seconds ago   Up <span style="color:#ae81ff">44</span> seconds   0.0.0.0:8000-&gt;8000/tcp, :::8000-&gt;8000/tcp   72_dynamodb_1
</code></pre></div><h2 id="テーブル作成">テーブル作成</h2>
<p>この状態でテーブルを作ってみます</p>
<p>テーブル作成のshellスクリプト<code>bin/create-table.sh</code>を作ってそれを実行します</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
aws dynamodb <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --region $REGION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --endpoint-url $ENDPOINT_URL <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    create-table <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --table-name $TABLE <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --attribute-definitions <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    AttributeName<span style="color:#f92672">=</span>userId,AttributeType<span style="color:#f92672">=</span>N <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    AttributeName<span style="color:#f92672">=</span>userName,AttributeType<span style="color:#f92672">=</span>S <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --key-schema <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    AttributeName<span style="color:#f92672">=</span>userId,KeyType<span style="color:#f92672">=</span>HASH AttributeName<span style="color:#f92672">=</span>userName,KeyType<span style="color:#f92672">=</span>RANGE <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --billing-mode PAY_PER_REQUEST
</code></pre></div><p><code>$REGION</code>と<code>$ENDPOINT_URL</code>と<code>$TABLE</code>は環境変数として読み込みます（直接書いてもいいです）
<code>AWS_ACCESS_KEY_ID</code>と<code>AWS_SECRET_ACCESS_KEY</code>はなんでもいいのでとりあえず<code>fake</code>としています</p>
<pre><code>% REGION=ap-northeast-1 ENDPOINT_URL=http://localhost:8000 TABLE=Sample AWS_ACCESS_KEY_ID=fake AWS_SECRET_ACCESS_KEY=fake sh bin/create-table.sh
{
    &quot;TableDescription&quot;: {
        &quot;AttributeDefinitions&quot;: [
            {
                &quot;AttributeName&quot;: &quot;userId&quot;,
                &quot;AttributeType&quot;: &quot;N&quot;
            },
            {
                &quot;AttributeName&quot;: &quot;userName&quot;,
                &quot;AttributeType&quot;: &quot;S&quot;
            }
        ],
        &quot;TableName&quot;: &quot;Sample&quot;,
        &quot;KeySchema&quot;: [
            {
                &quot;AttributeName&quot;: &quot;userId&quot;,
                &quot;KeyType&quot;: &quot;HASH&quot;
            },
            {
                &quot;AttributeName&quot;: &quot;userName&quot;,
                &quot;KeyType&quot;: &quot;RANGE&quot;
            }
        ],
        &quot;TableStatus&quot;: &quot;ACTIVE&quot;,
        &quot;CreationDateTime&quot;: &quot;2021-08-31T15:52:52.990000+09:00&quot;,
        &quot;ProvisionedThroughput&quot;: {
            &quot;LastIncreaseDateTime&quot;: &quot;1970-01-01T09:00:00+09:00&quot;,
            &quot;LastDecreaseDateTime&quot;: &quot;1970-01-01T09:00:00+09:00&quot;,
            &quot;NumberOfDecreasesToday&quot;: 0,
            &quot;ReadCapacityUnits&quot;: 0,
            &quot;WriteCapacityUnits&quot;: 0
        },
        &quot;TableSizeBytes&quot;: 0,
        &quot;ItemCount&quot;: 0,
        &quot;TableArn&quot;: &quot;arn:aws:dynamodb:ddblocal:000000000000:table/Sample&quot;,
        &quot;BillingModeSummary&quot;: {
            &quot;BillingMode&quot;: &quot;PAY_PER_REQUEST&quot;,
            &quot;LastUpdateToPayPerRequestDateTime&quot;: &quot;2021-08-31T15:52:52.990000+09:00&quot;
        }
    }
}
</code></pre><p>無事作成されましたね</p>
<p>テーブル一覧を確認してみます（もちろんshellスクリプトで）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
aws dynamodb <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --region $REGION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --endpoint-url $ENDPOINT_URL <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  list-tables
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">% REGION<span style="color:#f92672">=</span>ap-northeast-1 ENDPOINT_URL<span style="color:#f92672">=</span>http://localhost:8000 AWS_ACCESS_KEY_ID<span style="color:#f92672">=</span>fake AWS_SECRET_ACCESS_KEY<span style="color:#f92672">=</span>fake sh bin/list-tables.sh
<span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;TableNames&#34;</span>: <span style="color:#f92672">[</span>
        <span style="color:#e6db74">&#34;Sample&#34;</span>
    <span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="項目挿入">項目挿入</h2>
<p>次に項目を入れてみましょう</p>
<p>これまたshellスクリプトを作ります</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
aws dynamodb <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --region $REGION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --endpoint-url $ENDPOINT_URL <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    put-item <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --table-name $TABLE <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --item <span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">    {
</span><span style="color:#e6db74">      &#34;userId&#34;: {
</span><span style="color:#e6db74">        &#34;N&#34;: &#34;1&#34;
</span><span style="color:#e6db74">       },
</span><span style="color:#e6db74">      &#34;userName&#34;: {
</span><span style="color:#e6db74">        &#34;S&#34;: &#34;山田太郎&#34;
</span><span style="color:#e6db74">      },
</span><span style="color:#e6db74">      &#34;age&#34;: {
</span><span style="color:#e6db74">        &#34;N&#34;: &#34;29&#34;
</span><span style="color:#e6db74">      },
</span><span style="color:#e6db74">      &#34;contactNumber&#34;: {
</span><span style="color:#e6db74">        &#34;S&#34;: &#34;080-1234-5678&#34;
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">  &#39;</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">% REGION<span style="color:#f92672">=</span>ap-northeast-1 ENDPOINT_URL<span style="color:#f92672">=</span>http://localhost:8000 TABLE<span style="color:#f92672">=</span>Sample AWS_ACCESS_KEY_ID<span style="color:#f92672">=</span>fake AWS_SECRET_ACCESS_KEY<span style="color:#f92672">=</span>fake sh bin/insert-item.sh
</code></pre></div><h2 id="scanで確認">scanで確認</h2>
<p>ではscanで挿入された項目を確認しましょう</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
aws dynamodb <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --region $REGION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --endpoint-url $ENDPOINT_URL <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  scan <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --table-name $TABLE
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">% REGION<span style="color:#f92672">=</span>ap-northeast-1 ENDPOINT_URL<span style="color:#f92672">=</span>http://localhost:8000 TABLE<span style="color:#f92672">=</span>Sample AWS_ACCESS_KEY_ID<span style="color:#f92672">=</span>fake AWS_SECRET_ACCESS_KEY<span style="color:#f92672">=</span>fake sh bin/scan.sh
<span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;Items&#34;</span>: <span style="color:#f92672">[</span>
        <span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;contactNumber&#34;</span>: <span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;S&#34;</span>: <span style="color:#e6db74">&#34;080-1234-5678&#34;</span>
            <span style="color:#f92672">}</span>,
            <span style="color:#e6db74">&#34;userName&#34;</span>: <span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;S&#34;</span>: <span style="color:#e6db74">&#34;山田太郎&#34;</span>
            <span style="color:#f92672">}</span>,
            <span style="color:#e6db74">&#34;userId&#34;</span>: <span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;N&#34;</span>: <span style="color:#e6db74">&#34;1&#34;</span>
            <span style="color:#f92672">}</span>,
            <span style="color:#e6db74">&#34;age&#34;</span>: <span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;N&#34;</span>: <span style="color:#e6db74">&#34;29&#34;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">]</span>,
    <span style="color:#e6db74">&#34;Count&#34;</span>: 1,
    <span style="color:#e6db74">&#34;ScannedCount&#34;</span>: 1,
    <span style="color:#e6db74">&#34;ConsumedCapacity&#34;</span>: null
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="環境変数とか">環境変数とか</h2>
<p>ほぼほぼ共通の環境変数とか毎度入力はだるいので<code>bin/config.sh</code>にまとめて</p>
<p>各スクリプトから呼び出します</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
export AWS_ACCESS_KEY_ID<span style="color:#f92672">=</span>dummy
export AWS_SECRET_ACCESS_KEY<span style="color:#f92672">=</span>dummykey
export REGION<span style="color:#f92672">=</span>ap-northeast-1
export ENDPOINT_URL<span style="color:#f92672">=</span>http://localhost:8000
</code></pre></div><p>以下のコードを各スクリプトで読み込みます</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">current_dir<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cd <span style="color:#66d9ef">$(</span>dirname $0<span style="color:#66d9ef">)</span>; pwd<span style="color:#66d9ef">)</span>
source <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>current_dir<span style="color:#e6db74">}</span><span style="color:#e6db74">/config.sh&#34;</span>
</code></pre></div><p>例）create-table.sh</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
current_dir<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cd <span style="color:#66d9ef">$(</span>dirname $0<span style="color:#66d9ef">)</span>; pwd<span style="color:#66d9ef">)</span>
source <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>current_dir<span style="color:#e6db74">}</span><span style="color:#e6db74">/config.sh&#34;</span>

aws dynamodb <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --region $REGION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --endpoint-url $ENDPOINT_URL <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    create-table <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --table-name $TABLE <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --attribute-definitions <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    AttributeName<span style="color:#f92672">=</span>userId,AttributeType<span style="color:#f92672">=</span>N <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    AttributeName<span style="color:#f92672">=</span>userName,AttributeType<span style="color:#f92672">=</span>S <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --key-schema <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    AttributeName<span style="color:#f92672">=</span>userId,KeyType<span style="color:#f92672">=</span>HASH AttributeName<span style="color:#f92672">=</span>userName,KeyType<span style="color:#f92672">=</span>RANGE <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --billing-mode PAY_PER_REQUEST
</code></pre></div><p><code>$TABLE</code>は柔軟性を考えて入力するようにしている（全て固定しても良いぞ？）</p>
<p>ということで次のコマンドでオールOK</p>
<pre><code>% TABLE=SampleTable bin/create-table.sh
</code></pre><h2 id="最後に">最後に</h2>
<p>ファイルの最終形態はこうですね（再掲）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">% tree
.
├── bin
│   ├── config.sh
│   ├── create-table.sh
│   ├── insert-item.sh
│   ├── list-tables.sh
│   └── scan.sh
└── docker-compose.yml
</code></pre></div><p><a href="https://github.com/GOD-oda/neta/tree/master/issues/72">https://github.com/GOD-oda/neta/tree/master/issues/72</a></p>
<h1 id="余談">余談</h1>
<p>AWS公式での手順は<a href="https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/DynamoDBLocal.DownloadingAndRunning.html">こちら</a></p>
<h1 id="参考">参考</h1>
<ul>
<li><a href="https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/DynamoDBLocal.UsageNotes.html#DynamoDBLocal.CommandLineOptions">https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/DynamoDBLocal.UsageNotes.html#DynamoDBLocal.CommandLineOptions</a></li>
<li><a href="https://developers.freee.co.jp/entry/dynamodb-local">https://developers.freee.co.jp/entry/dynamodb-local</a></li>
</ul>
</p>
            <p>
              
                
                  <a href="https://blog.oda.world/tags/docker/">#docker</a>
                
                  <a href="https://blog.oda.world/tags/dynamodb/">#DynamoDB</a>
                
              
            </p>
            <hr>
            <p>
              更新日 2021/09/12 16:48:16
            </p>
            
          </div>
        </div>
      </div>
  
      <div class="row">
        <div class="col s3 m1">
        
          <a class="btn-floating btn-large waves-effect waves-light" href="https://blog.oda.world/posts/40/">prev</a>
        
        </div>
        <div class="col s6 m10 center">&nbsp</div>
        <div class="col s3 m1">
        
          <a class="btn-floating btn-large waves-effect waves-light" href="https://blog.oda.world/posts/74/">next</a>
        
        </div>
      </div>
  
    </div>
  </div>
</div>

  <footer class="container">
    <div class="copyright">
      © 2021 ODA WORLD
    </div>
  </footer>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="https://blog.oda.world/js/materialize.min.js"></script>
  <script src="https://blog.oda.world/js/init.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  </body>
</html>

