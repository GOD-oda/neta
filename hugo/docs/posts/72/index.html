<!DOCTYPE html>
<html lang="ja" prefix="og: http://ogp.me/ns#">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
  <meta name="description" content="前提 ローカルでDynamoDBに関するコマンドを実行する docker-compose.ymlを使う 作ったテーブルや項目は残しておきたい aws" />
  <meta property="og:title" content="DynamoDBをローカル環境に作る" />
  <meta property="og:type" content="article" />
  <meta property="og:image" content="https://oda.world/images/ogImage/default.png" />
  <meta property="og:site_name" content="ODA WORLD" />
  <meta property="og:description" content="前提 ローカルでDynamoDBに関するコマンドを実行する docker-compose.ymlを使う 作ったテーブルや項目は残しておきたい aws" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@oskfjzp" />
  <meta name="twitter:player" content="@oskfjzp" />
  <title>DynamoDBをローカル環境に作る</title>

  
  <link rel="apple-touch-icon" sizes="57x57" href="https://oda.world/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://oda.world/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://oda.world/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://oda.world/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://oda.world/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://oda.world/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://oda.world/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://oda.world/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://oda.world/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="https://oda.world/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://oda.world/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="https://oda.world/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://oda.world/favicon-16x16.png">
  <link rel="manifest" href="https://oda.world/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/tomorrow-night-bright.min.css">

  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  
  <link rel="stylesheet" href="https://oda.world/sass/main.min.18dabd5b90f48e6861583fa08160bf89651247df35f6ec24c572f54f8203485d.css">

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-M5XP83QSK8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-M5XP83QSK8');
  </script>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6572411330656614"
          crossorigin="anonymous"></script>
</head>
<body>
  <header>
    <div class="container">
      <h1 class="text-center">DynamoDBをローカル環境に作る</h1>
      <div class="icon-content d-flex justify-content-evenly">
        
        
        <a href="https://github.com/GOD-oda"><img src="https://oda.world/images/github.png"></a>
        
        
        <a href="https://www.facebook.com/last.pass.oda"><img src="https://oda.world/images/facebook.png"></a>
        
        
        <a href="https://twitter.com/@oskfjzp"><img src="https://oda.world/images/twitter.png"></a>
        
        
        
        <a href="https://oda.world/index.xml"><img src="https://oda.world/images/feed.png"></a>
      </div>
    </div>
  </header>



<article>
  <div class="container">
    <aside class="mb-1 text-end">
      <div class="publish-date">
        公開日: <time datetime="2021-09-12 16:48:16 &#43;0900 &#43;0900">2021/09/12 16:48:16</time>
      </div>
      <div class="updated-date">
        更新日: <time datetime="2022-09-12 14:58:51 &#43;0900 &#43;0900">2022/09/12 14:58:51</time>
      </div>
    </aside>

    <div class="section row">
      <div class="col-md-9">
        <div class="content">
          <h2 id="前提">前提</h1>
<ul>
<li>ローカルでDynamoDBに関するコマンドを実行する</li>
<li>docker-compose.ymlを使う</li>
<li>作ったテーブルや項目は残しておきたい</li>
<li>awsコマンドは打てる状態でshellスクリプトで実行する</li>
</ul>
<h2 id="やることとゴール">やることとゴール</h1>
<ul>
<li>dynamodbのコンテナをdocker-compose.ymlで</li>
<li>テーブル作成</li>
<li>テーブル確認</li>
<li>項目挿入</li>
<li>scan実行</li>
<li>データのマウント</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">% tree
.
├── bin
│   ├── config.sh
│   ├── create-table.sh
│   ├── insert-item.sh
│   ├── list-tables.sh
│   └── scan.sh
└── docker-compose.yml
</code></pre></div><h2 id="環境用意">環境用意</h1>
<h2 id="docker-composeyml">docker-compose.yml</h2>
<p>まずは<code>docker-compose.yml</code>で<code>DynamoDB Local</code>イメージのコンテナの準備をする</p>
<p>動作する必要最低限の<code>docker-compose.yml</code>はこうなる</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3.8&#39;</span>
<span style="color:#f92672">services</span>:
  <span style="color:#f92672">dynamodb</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">amazon/dynamodb-local</span>
</code></pre></div><p>この状態で<code>docker-compose up</code>を実行するとイメージを取得してコンテナが立ち上がる</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% docker-compose up
Creating network <span style="color:#e6db74">&#34;72_default&#34;</span> with the default driver
Pulling dynamodb <span style="color:#f92672">(</span>amazon/dynamodb-local:<span style="color:#f92672">)</span>...
latest: Pulling from amazon/dynamodb-local
2cbe74538cb5: Pull complete
137077f50205: Pull complete
58932e640a40: Pull complete
Digest: sha256:bdd26570dc0e0ae49e1ea9d49ff662a6a1afe9121dd25793dc40d02802e7e806
Status: Downloaded newer image <span style="color:#66d9ef">for</span> amazon/dynamodb-local:latest
Creating 72_dynamodb_1 ... <span style="color:#66d9ef">done</span>
Attaching to 72_dynamodb_1
dynamodb_1  | Initializing DynamoDB Local with the following configuration:
dynamodb_1  | Port:	<span style="color:#ae81ff">8000</span>
dynamodb_1  | InMemory:	true
dynamodb_1  | DbPath:	null
dynamodb_1  | SharedDb:	false
dynamodb_1  | shouldDelayTransientStatuses:	false
dynamodb_1  | CorsParams:	*
dynamodb_1  |

</code></pre></div><p>さて、ログを見ると<code>InMemory: true</code>となっており、このままだとコンテナを落とすとせっかく投入したデータが消えてしまいます</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">dynamodb_1  | Initializing DynamoDB Local with the following configuration:
dynamodb_1  | Port:	<span style="color:#ae81ff">8000</span>
dynamodb_1  | InMemory:	true    &lt;---------------------ここ
.
.
.
</code></pre></div><p>消えないようにボリュームマウントしたいわけですがこの<code>InMemory</code>オプションが邪魔になります</p>
<p>ということで<code>docker-compose.yml</code>に追記します</p>
<ul>
<li>commandを上書きしましょ</li>
<li>portの設定をしないとホスト側からコンテナ側へ繋げられないね？</li>
<li>volumesでマウントするんだ</li>
</ul>
<p>完成したのがこちら</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">  version: &#39;3.8&#39;
  services:
    dynamodb:
      image: amazon/dynamodb-local
<span style="color:#a6e22e">+     command: &#34;-jar DynamoDBLocal.jar -dbPath .&#34;
</span><span style="color:#a6e22e">+     ports:
</span><span style="color:#a6e22e">+       - &#34;8000:8000&#34;
</span><span style="color:#a6e22e">+     volumes:
</span><span style="color:#a6e22e">+       - &#34;dynamodb:/home/dynamodblocal&#34;
</span><span style="color:#a6e22e">+ volumes:
</span><span style="color:#a6e22e">+   dynamodb:
</span><span style="color:#a6e22e">+     driver: local
</span></code></pre></div><p>ちなみにデフォルトのコマンドはこのようになってますね</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% docker ps --no-trunc -f ancestor<span style="color:#f92672">=</span>amazon/dynamodb-local
CONTAINER ID                                                       IMAGE                   COMMAND                                   CREATED          STATUS          PORTS      NAMES
6a527476c032121902fcedfef532ceed06e548c6a38c46966bcc69fb9855e58b   amazon/dynamodb-local   <span style="color:#e6db74">&#34;java -jar DynamoDBLocal.jar -inMemory&#34;</span>   <span style="color:#ae81ff">16</span> minutes ago   Up <span style="color:#ae81ff">16</span> minutes   8000/tcp   72_dynamodb_1
</code></pre></div><p>コンテナを起動して、COMMANDとPORTS状態を確認してみましょう</p>
<p>問題なさそうですね</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% docker ps --no-trunc -f ancestor<span style="color:#f92672">=</span>amazon/dynamodb-local
CONTAINER ID                                                       IMAGE                   COMMAND                                   CREATED          STATUS          PORTS                                       NAMES
fd850211e368d4522968e6f9f43c7e2764ac3b1e28cc14083f88bbe1bf9914ad   amazon/dynamodb-local   <span style="color:#e6db74">&#34;java -jar DynamoDBLocal.jar -dbPath .&#34;</span>   <span style="color:#ae81ff">45</span> seconds ago   Up <span style="color:#ae81ff">44</span> seconds   0.0.0.0:8000-&gt;8000/tcp, :::8000-&gt;8000/tcp   72_dynamodb_1
</code></pre></div><h2 id="テーブル作成">テーブル作成</h2>
<p>この状態でテーブルを作ってみます</p>
<p>テーブル作成のshellスクリプト<code>bin/create-table.sh</code>を作ってそれを実行します</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
aws dynamodb <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --region $REGION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --endpoint-url $ENDPOINT_URL <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    create-table <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --table-name $TABLE <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --attribute-definitions <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    AttributeName<span style="color:#f92672">=</span>userId,AttributeType<span style="color:#f92672">=</span>N <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    AttributeName<span style="color:#f92672">=</span>userName,AttributeType<span style="color:#f92672">=</span>S <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --key-schema <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    AttributeName<span style="color:#f92672">=</span>userId,KeyType<span style="color:#f92672">=</span>HASH AttributeName<span style="color:#f92672">=</span>userName,KeyType<span style="color:#f92672">=</span>RANGE <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --billing-mode PAY_PER_REQUEST
</code></pre></div><p><code>$REGION</code>と<code>$ENDPOINT_URL</code>と<code>$TABLE</code>は環境変数として読み込みます（直接書いてもいいです）
<code>AWS_ACCESS_KEY_ID</code>と<code>AWS_SECRET_ACCESS_KEY</code>はなんでもいいのでとりあえず<code>fake</code>としています</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% REGION<span style="color:#f92672">=</span>ap-northeast-1 ENDPOINT_URL<span style="color:#f92672">=</span>http://localhost:8000 TABLE<span style="color:#f92672">=</span>Sample AWS_ACCESS_KEY_ID<span style="color:#f92672">=</span>fake AWS_SECRET_ACCESS_KEY<span style="color:#f92672">=</span>fake sh bin/create-table.sh
<span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;TableDescription&#34;</span>: <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;AttributeDefinitions&#34;</span>: <span style="color:#f92672">[</span>
            <span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;AttributeName&#34;</span>: <span style="color:#e6db74">&#34;userId&#34;</span>,
                <span style="color:#e6db74">&#34;AttributeType&#34;</span>: <span style="color:#e6db74">&#34;N&#34;</span>
            <span style="color:#f92672">}</span>,
            <span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;AttributeName&#34;</span>: <span style="color:#e6db74">&#34;userName&#34;</span>,
                <span style="color:#e6db74">&#34;AttributeType&#34;</span>: <span style="color:#e6db74">&#34;S&#34;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">]</span>,
        <span style="color:#e6db74">&#34;TableName&#34;</span>: <span style="color:#e6db74">&#34;Sample&#34;</span>,
        <span style="color:#e6db74">&#34;KeySchema&#34;</span>: <span style="color:#f92672">[</span>
            <span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;AttributeName&#34;</span>: <span style="color:#e6db74">&#34;userId&#34;</span>,
                <span style="color:#e6db74">&#34;KeyType&#34;</span>: <span style="color:#e6db74">&#34;HASH&#34;</span>
            <span style="color:#f92672">}</span>,
            <span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;AttributeName&#34;</span>: <span style="color:#e6db74">&#34;userName&#34;</span>,
                <span style="color:#e6db74">&#34;KeyType&#34;</span>: <span style="color:#e6db74">&#34;RANGE&#34;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">]</span>,
        <span style="color:#e6db74">&#34;TableStatus&#34;</span>: <span style="color:#e6db74">&#34;ACTIVE&#34;</span>,
        <span style="color:#e6db74">&#34;CreationDateTime&#34;</span>: <span style="color:#e6db74">&#34;2021-08-31T15:52:52.990000+09:00&#34;</span>,
        <span style="color:#e6db74">&#34;ProvisionedThroughput&#34;</span>: <span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;LastIncreaseDateTime&#34;</span>: <span style="color:#e6db74">&#34;1970-01-01T09:00:00+09:00&#34;</span>,
            <span style="color:#e6db74">&#34;LastDecreaseDateTime&#34;</span>: <span style="color:#e6db74">&#34;1970-01-01T09:00:00+09:00&#34;</span>,
            <span style="color:#e6db74">&#34;NumberOfDecreasesToday&#34;</span>: 0,
            <span style="color:#e6db74">&#34;ReadCapacityUnits&#34;</span>: 0,
            <span style="color:#e6db74">&#34;WriteCapacityUnits&#34;</span>: <span style="color:#ae81ff">0</span>
        <span style="color:#f92672">}</span>,
        <span style="color:#e6db74">&#34;TableSizeBytes&#34;</span>: 0,
        <span style="color:#e6db74">&#34;ItemCount&#34;</span>: 0,
        <span style="color:#e6db74">&#34;TableArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:dynamodb:ddblocal:000000000000:table/Sample&#34;</span>,
        <span style="color:#e6db74">&#34;BillingModeSummary&#34;</span>: <span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;BillingMode&#34;</span>: <span style="color:#e6db74">&#34;PAY_PER_REQUEST&#34;</span>,
            <span style="color:#e6db74">&#34;LastUpdateToPayPerRequestDateTime&#34;</span>: <span style="color:#e6db74">&#34;2021-08-31T15:52:52.990000+09:00&#34;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>無事作成されましたね</p>
<p>テーブル一覧を確認してみます（もちろんshellスクリプトで）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
aws dynamodb <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --region $REGION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --endpoint-url $ENDPOINT_URL <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  list-tables
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% REGION<span style="color:#f92672">=</span>ap-northeast-1 ENDPOINT_URL<span style="color:#f92672">=</span>http://localhost:8000 AWS_ACCESS_KEY_ID<span style="color:#f92672">=</span>fake AWS_SECRET_ACCESS_KEY<span style="color:#f92672">=</span>fake sh bin/list-tables.sh
<span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;TableNames&#34;</span>: <span style="color:#f92672">[</span>
        <span style="color:#e6db74">&#34;Sample&#34;</span>
    <span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="項目挿入">項目挿入</h2>
<p>次に項目を入れてみましょう</p>
<p>これまたshellスクリプトを作ります</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
aws dynamodb <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --region $REGION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --endpoint-url $ENDPOINT_URL <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    put-item <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --table-name $TABLE <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --item <span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">    {
</span><span style="color:#e6db74">      &#34;userId&#34;: {
</span><span style="color:#e6db74">        &#34;N&#34;: &#34;1&#34;
</span><span style="color:#e6db74">       },
</span><span style="color:#e6db74">      &#34;userName&#34;: {
</span><span style="color:#e6db74">        &#34;S&#34;: &#34;山田太郎&#34;
</span><span style="color:#e6db74">      },
</span><span style="color:#e6db74">      &#34;age&#34;: {
</span><span style="color:#e6db74">        &#34;N&#34;: &#34;29&#34;
</span><span style="color:#e6db74">      },
</span><span style="color:#e6db74">      &#34;contactNumber&#34;: {
</span><span style="color:#e6db74">        &#34;S&#34;: &#34;080-1234-5678&#34;
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">  &#39;</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">% REGION<span style="color:#f92672">=</span>ap-northeast-1 ENDPOINT_URL<span style="color:#f92672">=</span>http://localhost:8000 TABLE<span style="color:#f92672">=</span>Sample AWS_ACCESS_KEY_ID<span style="color:#f92672">=</span>fake AWS_SECRET_ACCESS_KEY<span style="color:#f92672">=</span>fake sh bin/insert-item.sh
</code></pre></div><h2 id="scanで確認">scanで確認</h2>
<p>ではscanで挿入された項目を確認しましょう</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
aws dynamodb <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --region $REGION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --endpoint-url $ENDPOINT_URL <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  scan <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --table-name $TABLE
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% REGION<span style="color:#f92672">=</span>ap-northeast-1 ENDPOINT_URL<span style="color:#f92672">=</span>http://localhost:8000 TABLE<span style="color:#f92672">=</span>Sample AWS_ACCESS_KEY_ID<span style="color:#f92672">=</span>fake AWS_SECRET_ACCESS_KEY<span style="color:#f92672">=</span>fake sh bin/scan.sh
<span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;Items&#34;</span>: <span style="color:#f92672">[</span>
        <span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;contactNumber&#34;</span>: <span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;S&#34;</span>: <span style="color:#e6db74">&#34;080-1234-5678&#34;</span>
            <span style="color:#f92672">}</span>,
            <span style="color:#e6db74">&#34;userName&#34;</span>: <span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;S&#34;</span>: <span style="color:#e6db74">&#34;山田太郎&#34;</span>
            <span style="color:#f92672">}</span>,
            <span style="color:#e6db74">&#34;userId&#34;</span>: <span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;N&#34;</span>: <span style="color:#e6db74">&#34;1&#34;</span>
            <span style="color:#f92672">}</span>,
            <span style="color:#e6db74">&#34;age&#34;</span>: <span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;N&#34;</span>: <span style="color:#e6db74">&#34;29&#34;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">]</span>,
    <span style="color:#e6db74">&#34;Count&#34;</span>: 1,
    <span style="color:#e6db74">&#34;ScannedCount&#34;</span>: 1,
    <span style="color:#e6db74">&#34;ConsumedCapacity&#34;</span>: null
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="環境変数とか">環境変数とか</h2>
<p>ほぼほぼ共通の環境変数とか毎度入力はだるいので<code>bin/config.sh</code>にまとめて</p>
<p>各スクリプトから呼び出します</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
export AWS_ACCESS_KEY_ID<span style="color:#f92672">=</span>dummy
export AWS_SECRET_ACCESS_KEY<span style="color:#f92672">=</span>dummykey
export REGION<span style="color:#f92672">=</span>ap-northeast-1
export ENDPOINT_URL<span style="color:#f92672">=</span>http://localhost:8000
</code></pre></div><p>以下のコードを各スクリプトで読み込みます</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">current_dir<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cd <span style="color:#66d9ef">$(</span>dirname $0<span style="color:#66d9ef">)</span>; pwd<span style="color:#66d9ef">)</span>
source <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>current_dir<span style="color:#e6db74">}</span><span style="color:#e6db74">/config.sh&#34;</span>
</code></pre></div><p>例）create-table.sh</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
current_dir<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cd <span style="color:#66d9ef">$(</span>dirname $0<span style="color:#66d9ef">)</span>; pwd<span style="color:#66d9ef">)</span>
source <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>current_dir<span style="color:#e6db74">}</span><span style="color:#e6db74">/config.sh&#34;</span>

aws dynamodb <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --region $REGION <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --endpoint-url $ENDPOINT_URL <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    create-table <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --table-name $TABLE <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --attribute-definitions <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    AttributeName<span style="color:#f92672">=</span>userId,AttributeType<span style="color:#f92672">=</span>N <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    AttributeName<span style="color:#f92672">=</span>userName,AttributeType<span style="color:#f92672">=</span>S <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --key-schema <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    AttributeName<span style="color:#f92672">=</span>userId,KeyType<span style="color:#f92672">=</span>HASH AttributeName<span style="color:#f92672">=</span>userName,KeyType<span style="color:#f92672">=</span>RANGE <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --billing-mode PAY_PER_REQUEST
</code></pre></div><p><code>$TABLE</code>は柔軟性を考えて入力するようにしている（全て固定しても良いぞ？）</p>
<p>ということで次のコマンドでオールOK</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% TABLE<span style="color:#f92672">=</span>SampleTable bin/create-table.sh
</code></pre></div><h2 id="最後に">最後に</h2>
<p>ファイルの最終形態はこうですね（再掲）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% tree
.
├── bin
│   ├── config.sh
│   ├── create-table.sh
│   ├── insert-item.sh
│   ├── list-tables.sh
│   └── scan.sh
└── docker-compose.yml
</code></pre></div><p><a href="https://github.com/GOD-oda/neta/tree/master/issues/72">https://github.com/GOD-oda/neta/tree/master/issues/72</a></p>
<h2 id="余談">余談</h1>
<p>AWS公式での手順は<a href="https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/DynamoDBLocal.DownloadingAndRunning.html">こちら</a></p>
<h2 id="参考">参考</h1>
<ul>
<li><a href="https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/DynamoDBLocal.UsageNotes.html#DynamoDBLocal.CommandLineOptions">https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/DynamoDBLocal.UsageNotes.html#DynamoDBLocal.CommandLineOptions</a></li>
<li><a href="https://developers.freee.co.jp/entry/dynamodb-local">https://developers.freee.co.jp/entry/dynamodb-local</a></li>
</ul>


          <hr>

          <div class="tags">
  
    
      <a href="https://oda.world/tags/docker/" class="tag"># docker</a>
    
      <a href="https://oda.world/tags/dynamodb/" class="tag"># DynamoDB</a>
    
  
</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="toc sticky-top">
          <div class="toc-title">
            目次
          </div>
          <div class="toc-body">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#前提">前提</a></li>
    <li><a href="#やることとゴール">やることとゴール</a></li>
    <li><a href="#環境用意">環境用意</a>
      <ul>
        <li><a href="#docker-composeyml">docker-compose.yml</a></li>
        <li><a href="#テーブル作成">テーブル作成</a></li>
        <li><a href="#項目挿入">項目挿入</a></li>
        <li><a href="#scanで確認">scanで確認</a></li>
        <li><a href="#環境変数とか">環境変数とか</a></li>
        <li><a href="#最後に">最後に</a></li>
      </ul>
    </li>
    <li><a href="#余談">余談</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</article>

  <footer>
    <div class="container">
      <div class="copyright">
        © 2021 ODA WORLD
      </div>
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

  </body>
</html>

