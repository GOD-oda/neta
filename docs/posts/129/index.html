<!DOCTYPE html>
<html lang="ja" prefix="og: http://ogp.me/ns#">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
  <meta name="description" content="前提 Laravelの初期化が終わっている Lighthouseを使う デフォルトのスキーマを利用する コードはこちらにまとめてある sqlite準備" />
  <meta property="og:title" content="LaravelでGraphQLを使う" />
  <meta property="og:type" content="article" />
  <meta property="og:image" content="https://oda.world/images/ogImage/129.png" />
  <meta property="og:site_name" content="ODA WORLD" />
  <meta property="og:description" content="前提 Laravelの初期化が終わっている Lighthouseを使う デフォルトのスキーマを利用する コードはこちらにまとめてある sqlite準備" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@oskfjzp" />
  <meta name="twitter:player" content="@oskfjzp" />
  <title>LaravelでGraphQLを使う</title>

  
  <link rel="apple-touch-icon" sizes="57x57" href="https://oda.world/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://oda.world/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://oda.world/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://oda.world/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://oda.world/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://oda.world/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://oda.world/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://oda.world/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://oda.world/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="https://oda.world/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://oda.world/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="https://oda.world/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://oda.world/favicon-16x16.png">
  <link rel="manifest" href="https://oda.world/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/tomorrow-night-bright.min.css">

  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  
  <link rel="stylesheet" href="https://oda.world/sass/main.min.50d6e56410147544b69d3b32821363cf7c9f4e3afaee125062f67ee727ce5c9a.css">

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-M5XP83QSK8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-M5XP83QSK8');
  </script>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6572411330656614"
          crossorigin="anonymous"></script>
</head>
<body>
  <header>
    <div class="container">
      <h1 class="text-center">LaravelでGraphQLを使う</h1>
      <div class="icon-content d-flex justify-content-evenly">
        
        
        <a href="https://github.com/GOD-oda"><img src="https://oda.world/images/github.png"></a>
        
        
        <a href="https://www.facebook.com/last.pass.oda"><img src="https://oda.world/images/facebook.png"></a>
        
        
        <a href="https://twitter.com/@oskfjzp"><img src="https://oda.world/images/twitter.png"></a>
        
        
        
        <a href="https://oda.world/index.xml"><img src="https://oda.world/images/feed.png"></a>
      </div>
    </div>
  </header>



<article>
  <div class="container">
    <aside class="mb-1 text-end">
      <div class="publish-date">
        公開日: <time datetime="2022-11-13 18:06:03 &#43;0900 JST">2022/11/13 18:06:03</time>
      </div>
      <div class="updated-date">
        更新日: <time datetime="2022-11-14 01:01:51 &#43;0900 JST">2022/11/14 01:01:51</time>
      </div>
    </aside>

    <div class="section row">
      <div class="col-md-9">
        <div class="content">
          <h2 id="前提">前提</h1>
<ul>
<li>Laravelの初期化が終わっている</li>
<li><a href="https://lighthouse-php.com/">Lighthouse</a>を使う</li>
<li>デフォルトのスキーマを利用する</li>
</ul>
<p>コードは<a href="https://github.com/GOD-oda/neta/tree/master/issues/129">こちら</a>にまとめてある</p>
<h2 id="sqlite準備">sqlite準備</h1>
<ul>
<li><code>DB_CONNECTION</code>を<code>sqlite</code>にする</li>
<li><code>DB_DATABASE</code>をコメントアウトする</li>
<li>空の<code>database/database.sqlite</code>を作成する</li>
</ul>
<div class="highlight" fn="src/.env"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-env" data-lang="env">.
.
.
DB_CONNECTION<span style="color:#f92672">=</span>sqlite
DB_HOST<span style="color:#f92672">=</span>127.0.0.1
DB_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">3306</span>
<span style="color:#75715e">#DB_DATABASE=laravel</span>
DB_USERNAME<span style="color:#f92672">=</span>root
DB_PASSWORD<span style="color:#f92672">=</span>
.
.
.
</code></pre></div><p>マイグレーションと初期データを入れる（<code>database/seeders/DatabaseSeeder.php</code>のコメントアウトを外しておく）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% docker compose exec app php artisan migrate:migrate --seed
</code></pre></div><h2 id="lighthouseをインストールする">Lighthouseをインストールする</h1>
<p>コンテナにてコマンドを実行する</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% composer require nuwave/lighthouse
</code></pre></div><p>インストールが完了した時点で<code>graphql</code>というエンドポイントが増えていることが確認できる</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% php artisan route:list

  GET|HEAD   / ...................................................................................................................... 
  POST       _ignition/execute-solution ............... ignition.executeSolution › Spatie<span style="color:#ae81ff">\L</span>aravelIgnition › ExecuteSolutionController
  GET|HEAD   _ignition/health-check ........................... ignition.healthCheck › Spatie<span style="color:#ae81ff">\L</span>aravelIgnition › HealthCheckController
  POST       _ignition/update-config ........................ ignition.updateConfig › Spatie<span style="color:#ae81ff">\L</span>aravelIgnition › UpdateConfigController
  GET|HEAD   api/user ............................................................................................................... 
  GET|HEAD   api/users .............................................................................................................. 
  GET|POST|HEAD graphql ............................................................. graphql › Nuwave<span style="color:#ae81ff">\L</span>ighthouse › GraphQLController
  GET|HEAD   sanctum/csrf-cookie .................................. sanctum.csrf-cookie › Laravel<span style="color:#ae81ff">\S</span>anctum › CsrfCookieController@show
</code></pre></div><p>スキーマファイルをデフォルトから複製する</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% php artisan vendor:publish --tag<span style="color:#f92672">=</span>lighthouse-schema
</code></pre></div><div class="highlight" fn="src/graphql/schema.graphql"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-graphql" data-lang="graphql"><span style="color:#e6db74">&#34;A datetime string with format `Y-m-d H:i:s`, e.g. `2018-05-23 13:43:32`.&#34;</span>
<span style="color:#66d9ef">scalar</span> <span style="color:#a6e22e">DateTime</span> <span style="color:#a6e22e">@scalar</span>(class: <span style="color:#e6db74">&#34;Nuwave\\Lighthouse\\Schema\\Types\\Scalars\\DateTime&#34;</span>)

<span style="color:#e6db74">&#34;Indicates what fields are available at the top level of a query operation.&#34;</span>
<span style="color:#a6e22e">type</span> Query {
    <span style="color:#e6db74">&#34;Find a single user by an identifying attribute.&#34;</span>
    user(
      <span style="color:#e6db74">&#34;Search by primary key.&#34;</span>
      id: <span style="color:#a6e22e">ID</span> <span style="color:#a6e22e">@eq</span> <span style="color:#a6e22e">@rules</span>(apply: [<span style="color:#e6db74">&#34;prohibits:email&#34;</span>, <span style="color:#e6db74">&#34;required_without:email&#34;</span>])

      <span style="color:#e6db74">&#34;Search by email address.&#34;</span>
      <span style="color:#a6e22e">email</span>: <span style="color:#a6e22e">String</span> <span style="color:#a6e22e">@eq</span> <span style="color:#a6e22e">@rules</span>(apply: [<span style="color:#e6db74">&#34;prohibits:id&#34;</span>, <span style="color:#e6db74">&#34;required_without:id&#34;</span>, <span style="color:#e6db74">&#34;email&#34;</span>])
    ): <span style="color:#a6e22e">User</span> <span style="color:#a6e22e">@find</span>

    <span style="color:#e6db74">&#34;List multiple users.&#34;</span>
    <span style="color:#a6e22e">users</span>(
      <span style="color:#e6db74">&#34;Filters by name. Accepts SQL LIKE wildcards `%` and `_`.&#34;</span>
      name: <span style="color:#a6e22e">String</span> <span style="color:#a6e22e">@where</span>(operator: <span style="color:#e6db74">&#34;like&#34;</span>)
    ): [<span style="color:#a6e22e">User</span>!]! <span style="color:#a6e22e">@paginate</span>(<span style="color:#a6e22e">defaultCount</span>: <span style="color:#a6e22e">10</span>)
}

<span style="color:#e6db74">&#34;Account of a person who utilizes this application.&#34;</span>
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">User</span> {
    <span style="color:#e6db74">&#34;Unique primary key.&#34;</span>
    id: <span style="color:#a6e22e">ID</span>!

    <span style="color:#e6db74">&#34;Non-unique name.&#34;</span>
    name: <span style="color:#a6e22e">String</span>!

    <span style="color:#e6db74">&#34;Unique email address.&#34;</span>
    email: <span style="color:#a6e22e">String</span>!

    <span style="color:#e6db74">&#34;When the email was verified.&#34;</span>
    email_verified_at: <span style="color:#a6e22e">DateTime</span>

    <span style="color:#e6db74">&#34;When the account was created.&#34;</span>
    created_at: <span style="color:#a6e22e">DateTime</span>!

    <span style="color:#e6db74">&#34;When the account was last updated.&#34;</span>
    updated_at: <span style="color:#a6e22e">DateTime</span>!
}
</code></pre></div><h2 id="データ取得">データ取得</h1>
<h2 id="複数のuserを取得">複数のUserを取得</h2>
<ul>
<li>paginatorが必須としている<code>count</code>を指定する</li>
<li><code>currentPage</code>はなくても動作する</li>
<li><code>data</code>に欲しいUserの項目を指定する</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% curl -XPOST -H <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> -d <span style="color:#e6db74">&#39;{&#34;query&#34;:&#34;{users{paginatorInfo{count,currentPage}data{id,name,email}}}&#34;}&#39;</span> localhost:8080/graphql
<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;data&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;users&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;paginatorInfo&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;count&#34;</span>:10,<span style="color:#e6db74">&#34;currentPage&#34;</span>:1<span style="color:#f92672">}</span>,<span style="color:#e6db74">&#34;data&#34;</span>:<span style="color:#f92672">[{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Mrs. Aglae Hayes PhD&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;cayla30@example.net&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;2&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Delfina Bartell&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;audreanne01@example.org&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;3&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Darius Lehner PhD&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;zheidenreich@example.org&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;4&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Chase Trantow&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;franecki.roxane@example.net&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;5&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Cielo Morar PhD&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;lubowitz.jonathon@example.net&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;6&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Florine Kuhic&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;stephon40@example.com&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;7&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Ms. Eugenia Lueilwitz Jr.&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;arch.collins@example.org&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;8&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Cindy Welch&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;bridgette.hintz@example.org&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;9&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Ms. Cordie Waelchi&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;ncassin@example.com&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;10&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Ms. Rhoda Schaden&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;zlebsack@example.net&#34;</span><span style="color:#f92672">}]}}}</span>
</code></pre></div><p>1件のみ取得</p>
<ul>
<li>件数の絞りは<code>first</code>を使う（内部で定義されている）</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% curl -XPOST -H <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> -d <span style="color:#e6db74">&#39;{&#34;query&#34;:&#34;{users(first:1){paginatorInfo{count,currentPage}data{id,name,email}}}&#34;}&#39;</span> localhost:8080/graphql
<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;data&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;users&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;paginatorInfo&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;count&#34;</span>:1,<span style="color:#e6db74">&#34;currentPage&#34;</span>:1<span style="color:#f92672">}</span>,<span style="color:#e6db74">&#34;data&#34;</span>:<span style="color:#f92672">[{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Mrs. Aglae Hayes PhD&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;cayla30@example.net&#34;</span><span style="color:#f92672">}]}}}</span>
</code></pre></div><p>1件かつ2ページ目</p>
<ul>
<li>ページ指定は<code>page</code>を使う</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% curl -XPOST -H <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> -d <span style="color:#e6db74">&#39;{&#34;query&#34;:&#34;{users(first:1,page:2){paginatorInfo{count,currentPage}data{id,name,email}}}&#34;}&#39;</span> localhost:8080/graphql
<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;data&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;users&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;paginatorInfo&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;count&#34;</span>:1,<span style="color:#e6db74">&#34;currentPage&#34;</span>:2<span style="color:#f92672">}</span>,<span style="color:#e6db74">&#34;data&#34;</span>:<span style="color:#f92672">[{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;2&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Delfina Bartell&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;audreanne01@example.org&#34;</span><span style="color:#f92672">}]}}}</span>
</code></pre></div><p>名前で絞る</p>
<ul>
<li>LIKE検索になっているので<code>&quot;%foo%&quot;</code>の形にする</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% curl -XPOST -H <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> -d <span style="color:#e6db74">&#39;{&#34;query&#34;:&#34;{users(name:\&#34;%Aglae%\&#34;){paginatorInfo{count,currentPage}data{id,name,email}}}&#34;}&#39;</span> localhost:8080/graphql
<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;data&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;users&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;paginatorInfo&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;count&#34;</span>:1,<span style="color:#e6db74">&#34;currentPage&#34;</span>:1<span style="color:#f92672">}</span>,<span style="color:#e6db74">&#34;data&#34;</span>:<span style="color:#f92672">[{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Mrs. Aglae Hayes PhD&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;cayla30@example.net&#34;</span><span style="color:#f92672">}]}}}</span>
</code></pre></div><h2 id="1件取得">1件取得</h2>
<p>ID指定</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% curl -XPOST -H <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> -d <span style="color:#e6db74">&#39;{&#34;query&#34;:&#34;{user(id:1){id,name,email}}&#34;}&#39;</span> localhost:8080/graphql
<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;data&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;user&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Mrs. Aglae Hayes PhD&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;cayla30@example.net&#34;</span><span style="color:#f92672">}}</span>
</code></pre></div><p>email指定</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% curl -XPOST -H <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> -d <span style="color:#e6db74">&#39;{&#34;query&#34;:&#34;{user(email:\&#34;cayla30@example.net\&#34;){id,name,email}}&#34;}&#39;</span> localhost:8080/graphql
<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;data&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;user&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;Mrs. Aglae Hayes PhD&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;cayla30@example.net&#34;</span><span style="color:#f92672">}}}</span>
</code></pre></div><p>スキーマを見るとID指定は<code>required_without:email</code>、email指定は<code>required_without:id</code>となっているのでどちらかが必須となる</p>
<h2 id="tips">TIPS</h1>
<h2 id="補完">補完</h2>
<p>このようなシンタックスエラーが気になる時はヘルパーファイルを作ると良い</p>
<figure><img src="https://oda.world/images/129/1.webp"/>
</figure>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% php artisan lighthouse:ide-helper
Wrote schema directive definitions to /var/www/html/schema-directives.graphql.
Wrote definitions <span style="color:#66d9ef">for</span> programmatically registered types to /var/www/html/programmatic-types.graphql.
Wrote PHP definitions to /var/www/html/_lighthouse_ide_helper.php.

It is recommended to add them to your .gitignore file.
</code></pre></div><h2 id="gui">GUI</h2>
<p><a href="https://github.com/mll-lab/laravel-graphql-playground">laravel-graphql-playground</a>というのが紹介されているのでインストールする</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% composer require mll-lab/laravel-graphiql
</code></pre></div><p><code>graphiql</code>というエンドポイントが追加される</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% php artisan route:list

  GET|HEAD   / ........................................................................................................ 
  POST       _ignition/execute-solution . ignition.executeSolution › Spatie<span style="color:#ae81ff">\L</span>aravelIgnition › ExecuteSolutionController
  GET|HEAD   _ignition/health-check ............. ignition.healthCheck › Spatie<span style="color:#ae81ff">\L</span>aravelIgnition › HealthCheckController
  POST       _ignition/update-config .......... ignition.updateConfig › Spatie<span style="color:#ae81ff">\L</span>aravelIgnition › UpdateConfigController
  GET|HEAD   api/user ................................................................................................. 
  GET|HEAD   graphiql .................................................... graphiql › MLL<span style="color:#ae81ff">\G</span>raphiQL › GraphiQLController
  GET|POST|HEAD graphql ............................................... graphql › Nuwave<span style="color:#ae81ff">\L</span>ighthouse › GraphQLController
  GET|HEAD   sanctum/csrf-cookie .................... sanctum.csrf-cookie › Laravel<span style="color:#ae81ff">\S</span>anctum › CsrfCookieController@show

                                                                                                     Showing <span style="color:#f92672">[</span>8<span style="color:#f92672">]</span> routes
</code></pre></div><p>実際にアクセスしてクエリを書くと結果が返ってくる</p>
<figure><img src="https://oda.world/images/129/2.webp"/>
</figure>

<h2 id="参考">参考</h1>
<ul>
<li><a href="https://lighthouse-php.com/">https://lighthouse-php.com/</a></li>
<li><a href="https://graphql.org/">https://graphql.org/</a></li>
<li><a href="https://learn.liferay.com/dxp/latest/ja/headless-delivery/consuming-apis/consuming-graphql-apis.html">https://learn.liferay.com/dxp/latest/ja/headless-delivery/consuming-apis/consuming-graphql-apis.html</a></li>
<li><a href="https://qiita.com/yousan/items/c898f0d2ceb8f145e5a4">https://qiita.com/yousan/items/c898f0d2ceb8f145e5a4</a></li>
<li><a href="https://qiita.com/jintz/items/c9105dca1725224d36a8">https://qiita.com/jintz/items/c9105dca1725224d36a8</a></li>
<li><a href="https://qiita.com/TsukasaGR/items/1a8b0020e5e83e7a46c7">https://qiita.com/TsukasaGR/items/1a8b0020e5e83e7a46c7</a></li>
<li><a href="https://github.com/mll-lab/laravel-graphql-playground">https://github.com/mll-lab/laravel-graphql-playground</a></li>
</ul>


          <hr>

          <div class="tags">
  
    
      <a href="https://oda.world/tags/laravel/" class="tag"># laravel</a>
    
      <a href="https://oda.world/tags/graphql/" class="tag"># graphql</a>
    
  
</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="toc sticky-top">
          <div class="toc-title">
            目次
          </div>
          <div class="toc-body">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#前提">前提</a></li>
    <li><a href="#sqlite準備">sqlite準備</a></li>
    <li><a href="#lighthouseをインストールする">Lighthouseをインストールする</a></li>
    <li><a href="#データ取得">データ取得</a>
      <ul>
        <li><a href="#複数のuserを取得">複数のUserを取得</a></li>
        <li><a href="#1件取得">1件取得</a></li>
      </ul>
    </li>
    <li><a href="#tips">TIPS</a>
      <ul>
        <li><a href="#補完">補完</a></li>
        <li><a href="#gui">GUI</a></li>
      </ul>
    </li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</article>

  <footer>
    <div class="container">
      <div class="copyright">
        © 2021 ODA WORLD
      </div>
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

  </body>
</html>

